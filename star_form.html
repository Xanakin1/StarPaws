<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>StarPaws Constellation Generator</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap');

    html, body {
      margin: 0;
      padding: 0;
      font-family: 'Arial', sans-serif;
      height: 100%;
      background: radial-gradient(ellipse at bottom, #0a0a23 0%, #1a1a3e 100%);
      overflow: hidden;
      color: #fff;
      position: relative;
    }

    .starfield {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 1;
      pointer-events: none;
    }

    .container {
      position: relative;
      z-index: 2;
      max-width: 600px;
      margin: 60px auto;
      padding: 30px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 15px;
      box-shadow: 0 0 20px rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
    }

    h1 {
      text-align: center;
      font-family: 'Great Vibes', cursive;
      color: gold;
      font-size: 2.8em;
      margin-bottom: 20px;
      text-shadow: 1px 1px 10px #000;
    }

    label {
      display: block;
      margin-top: 15px;
      font-size: 14px;
      color: #eee;
    }

    input {
      width: 100%;
      padding: 12px;
      margin-top: 6px;
      border-radius: 6px;
      border: none;
      background: rgba(255, 255, 255, 0.08);
      color: #fff;
      font-size: 16px;
      backdrop-filter: blur(4px);
      box-shadow: inset 0 0 5px rgba(255, 255, 255, 0.05);
      box-sizing: border-box;
    }

    input:focus {
      outline: none;
      box-shadow: 0 0 10px gold;
    }

    button {
      margin-top: 25px;
      width: 100%;
      padding: 14px;
      font-size: 18px;
      color: #fff;
      background-color: gold;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
      transition: 0.3s ease;
    }

    button:hover {
      background-color: #f1c40f;
      box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
    }

    /* Twinkling animation for stars */
    .star {
      animation: twinkle 2s infinite;
    }

    .star:nth-child(odd) {
      animation-delay: 0.5s;
    }

    .star:nth-child(3n) {
      animation-delay: 1s;
    }

    @keyframes twinkle {
      0%, 100% { opacity: 0.3; }
      50% { opacity: 1; }
    }
  </style>
</head>
<body>
  <svg class="starfield" width="100%" height="100%" preserveAspectRatio="none" xmlns="http://www.w3.org/2000/svg">
    <!-- Background stars -->
    <circle class="star" cx="10%" cy="20%" r="1" fill="white" opacity="0.9" />
    <circle class="star" cx="30%" cy="10%" r="1.5" fill="white" opacity="0.8" />
    <circle class="star" cx="70%" cy="25%" r="1" fill="#fff" opacity="0.7" />
    <circle class="star" cx="90%" cy="5%" r="1.2" fill="#ffd" opacity="0.9" />
    <circle class="star" cx="50%" cy="50%" r="1.5" fill="white" opacity="0.6" />
    <circle class="star" cx="80%" cy="70%" r="1" fill="#eef" opacity="0.8" />
    <circle class="star" cx="20%" cy="60%" r="1" fill="#ddf" opacity="0.7" />
    <circle class="star" cx="15%" cy="40%" r="0.8" fill="white" opacity="0.5" />
    <circle class="star" cx="45%" cy="15%" r="1.2" fill="#ffe" opacity="0.9" />
    <circle class="star" cx="65%" cy="55%" r="0.9" fill="white" opacity="0.6" />
    <circle class="star" cx="25%" cy="80%" r="1.1" fill="#eef" opacity="0.8" />
    <circle class="star" cx="85%" cy="30%" r="0.7" fill="white" opacity="0.4" />
    <circle class="star" cx="35%" cy="75%" r="1.3" fill="#ffd" opacity="0.7" />
    <circle class="star" cx="55%" cy="35%" r="0.8" fill="white" opacity="0.6" />
    <circle class="star" cx="75%" cy="45%" r="1" fill="#ddf" opacity="0.8" />
    <circle class="star" cx="5%" cy="65%" r="0.9" fill="white" opacity="0.5" />
    <circle class="star" cx="95%" cy="85%" r="1.2" fill="#ffe" opacity="0.9" />
    <circle class="star" cx="40%" cy="90%" r="0.7" fill="white" opacity="0.6" />
    <circle class="star" cx="60%" cy="8%" r="1.1" fill="#eef" opacity="0.7" />
    <circle class="star" cx="18%" cy="25%" r="0.8" fill="white" opacity="0.5" />
    <circle class="star" cx="82%" cy="60%" r="1" fill="#ffd" opacity="0.8" />
    <circle class="star" cx="28%" cy="45%" r="0.9" fill="white" opacity="0.6" />
    <circle class="star" cx="72%" cy="15%" r="1.2" fill="#ddf" opacity="0.7" />
    <circle class="star" cx="48%" cy="70%" r="0.8" fill="white" opacity="0.5" />
    <circle class="star" cx="12%" cy="85%" r="1.1" fill="#ffe" opacity="0.9" />
    <circle class="star" cx="88%" cy="25%" r="0.7" fill="white" opacity="0.4" />
    <circle class="star" cx="38%" cy="55%" r="1" fill="#eef" opacity="0.8" />
    <circle class="star" cx="62%" cy="40%" r="0.9" fill="white" opacity="0.6" />
    <circle class="star" cx="22%" cy="10%" r="1.3" fill="#ffd" opacity="0.7" />
    <circle class="star" cx="78%" cy="80%" r="0.8" fill="white" opacity="0.5" />
  </svg>
  
  <div class="container">
    <h1>Generate Your Pet's Star Map</h1>
    <form id="star-form">
      <label for="petName">Pet Name:</label>
      <input type="text" id="petName" name="petName" required>
  
      <label for="adoptionDate">Adoption Date:</label>
      <input type="date" id="adoptionDate" name="adoptionDate" required>
  
      <label for="location">Adoption Location:</label>
      <input type="text" id="location" name="location" required>
  
      <label for="email">Your Email:</label>
      <input type="email" id="email" name="email" required>
  
      <button type="submit">Create Star Map</button>
    </form>
  </div>
  
  <script>
    // Store form data in memory for the session
    let formData = {};

    document.getElementById("star-form").addEventListener("submit", async function (e) {
      e.preventDefault();
  
      const petName = document.getElementById("petName").value;
      const adoptionDate = document.getElementById("adoptionDate").value;
      const location = document.getElementById("location").value;
      const email = document.getElementById("email").value;
  
      // Store form data in memory
      formData = {
        petName, 
        adoptionDate, 
        location, 
        email
      };

      // Debug: log the exact date being sent
      console.log('Date being sent to backend:', adoptionDate);
  
      try {
        const res = await fetch("/create-checkout-session", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ 
            email,
            petName,
            adoptionDate,
            location
          })
        });
  
        const data = await res.json();
  
        if (data.url) {
          window.location.href = data.url; // Redirect to Stripe checkout
        } else {
          alert("❌ Failed to redirect to payment.");
          console.error(data);
        }
      } catch (err) {
        alert("❌ Unexpected error occurred.");
        console.error(err);
      }
    });
  </script>
</body>
</html>